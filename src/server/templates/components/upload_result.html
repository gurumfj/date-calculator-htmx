{#
Template: upload_result.html
Description: Displays upload results with success/error messages and data table

Required Variables:
- request: Request - FastAPI request object
- success: bool - Whether upload was successful
- result: dict - Upload result containing:
  * message: str - Success/error message
  * file_type: str - Type of uploaded file
  * valid_count: int - Number of valid records
  * invalid_count: int - Number of invalid records
  * duplicates_removed: int - Number of duplicates removed
  * inserted_count: int - Number of records inserted
  * deleted_count: int - Number of records deleted
  * duplicate_count: int - Number of duplicate records
- table_html: str - Pre-rendered table HTML (if success)
#}

{% if success %}
<div class="alert alert-success" role="alert">
    <h5 class="alert-heading">✅ {{ result.message }}</h5>
    <details class="mt-3">
        <summary class="fw-bold">詳細資訊</summary>
        <ul class="list-unstyled mt-2">
            <li><strong>檔案類型:</strong> {{ result.file_type }}</li>
            <li><strong>有效記錄:</strong> {{ result.valid_count }} 條</li>
            {% if result.invalid_count > 0 %}
            <li><strong>無效記錄:</strong> {{ result.invalid_count }} 條</li>
            {% endif %}
            {% if result.get('duplicates_removed', 0) > 0 %}
            <li><strong>重複記錄:</strong> {{ result.duplicates_removed }} 條</li>
            {% endif %}
            {% if result.get('inserted_count', 0) > 0 %}
            <li><strong>新增記錄:</strong> {{ result.inserted_count }} 條</li>
            {% endif %}
            {% if result.get('deleted_count', 0) > 0 %}
            <li><strong>刪除記錄:</strong> {{ result.deleted_count }} 條</li>
            {% endif %}
            {% if result.get('duplicate_count', 0) > 0 %}
            <li><strong>保持記錄:</strong> {{ result.duplicate_count }} 條</li>
            {% endif %}
        </ul>
    </details>
</div>

<div class="mt-4">
    {{ table_html|safe }}
</div>

{% else %}
<div class="alert alert-danger" role="alert">
    <h5 class="alert-heading">❌ 上傳失敗: {{ result.message }}</h5>
    {% if result.get('file_type') != 'unknown' %}
    <details class="mt-3">
        <summary class="fw-bold">錯誤詳情</summary>
        <ul class="list-unstyled mt-2">
            <li><strong>檔案類型:</strong> {{ result.get('file_type', '未知') }}</li>
            <li><strong>有效記錄:</strong> {{ result.get('valid_count', 0) }} 條</li>
            <li><strong>無效記錄:</strong> {{ result.get('invalid_count', 0) }} 條</li>
        </ul>
    </details>
    {% else %}
    <p class="mt-2">請檢查檔案格式和欄位名稱是否正確</p>
    {% endif %}
</div>
{% endif %}