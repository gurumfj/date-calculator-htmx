<style>
/* Markdown content styling */
.markdown-content {
    color: #374151;
}

.markdown-content h1, .markdown-content h2, .markdown-content h3, 
.markdown-content h4, .markdown-content h5, .markdown-content h6 {
    font-weight: 600;
    margin: 0.5rem 0 0.25rem 0;
    color: #1f2937;
}

.markdown-content h1 { font-size: 1.25rem; }
.markdown-content h2 { font-size: 1.125rem; }
.markdown-content h3 { font-size: 1rem; }
.markdown-content h4, .markdown-content h5, .markdown-content h6 { font-size: 0.875rem; }

.markdown-content p {
    margin: 0.25rem 0;
    line-height: 1.4;
}

.markdown-content strong {
    font-weight: 600;
    color: #1f2937;
}

.markdown-content em {
    font-style: italic;
}

.markdown-content code {
    background-color: #f3f4f6;
    color: #dc2626;
    padding: 0.125rem 0.25rem;
    border-radius: 0.25rem;
    font-size: 0.875rem;
    font-family: 'Courier New', monospace;
}

.markdown-content pre {
    background-color: #f9fafb;
    border: 1px solid #e5e7eb;
    border-radius: 0.375rem;
    padding: 0.75rem;
    margin: 0.5rem 0;
    overflow-x: auto;
}

.markdown-content pre code {
    background-color: transparent;
    color: #374151;
    padding: 0;
}

.markdown-content ul, .markdown-content ol {
    margin: 0.5rem 0;
    padding-left: 1.25rem;
}

.markdown-content li {
    margin: 0.125rem 0;
    line-height: 1.4;
}

.markdown-content blockquote {
    border-left: 4px solid #d1d5db;
    padding-left: 0.75rem;
    margin: 0.5rem 0;
    color: #6b7280;
    font-style: italic;
}

.markdown-content table {
    border-collapse: collapse;
    width: 100%;
    margin: 0.5rem 0;
}

.markdown-content th, .markdown-content td {
    border: 1px solid #e5e7eb;
    padding: 0.375rem;
    text-align: left;
}

.markdown-content th {
    background-color: #f9fafb;
    font-weight: 600;
}

/* 確保在表格單元格內的markdown內容能正確顯示 */
td .markdown-content {
    display: block;
    word-wrap: break-word;
    overflow-wrap: break-word;
}

td .markdown-content * {
    max-width: 100%;
}

/* Loading spinner styles */
.loading-spinner {
    display: inline-block;
    width: 20px;
    height: 20px;
    border: 3px solid #f3f3f3;
    border-top: 3px solid #3498db;
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.htmx-indicator {
    display: none;
}

.htmx-request .htmx-indicator {
    display: inline-block;
}
</style>


<section>
    <h4 class="font-bold text-black mb-2 pb-1">記事 - {{ batch_name }}</h4>
    
    <!-- 活動任務區塊 (快速載入) -->
    <div class="relative">
        <div id="active-tasks-loading" class="htmx-indicator absolute inset-0 z-10 bg-white bg-opacity-90 flex items-center justify-center">
            <div class="flex items-center p-4 bg-blue-50 rounded shadow">
                <div class="loading-spinner"></div>
                <span class="ml-2 text-blue-600">正在更新活動任務...</span>
            </div>
        </div>
        <div id="active-tasks-container" 
             hx-get="article/active-tasks?batch_name={{ batch_name }}"
             hx-trigger="load, taskUncompleted from:body, taskCreated from:body, refreshActiveTaskCount from:body"
             hx-swap="innerHTML"
             hx-indicator="#active-tasks-loading">
            <div class="flex items-center justify-center p-8 bg-blue-50 rounded mb-4">
                <div class="loading-spinner"></div>
                <span class="ml-2 text-blue-600">正在載入活動任務...</span>
            </div>
        </div>
    </div>
    
    <!-- 已完成任務區塊 (延遲載入) -->
    <div class="relative">
        <div id="completed-tasks-loading" class="htmx-indicator absolute inset-0 z-10 bg-white bg-opacity-90 flex items-center justify-center">
            <div class="flex items-center p-4 bg-gray-50 rounded shadow">
                <div class="loading-spinner"></div>
                <span class="ml-2 text-gray-600">正在更新已完成任務...</span>
            </div>
        </div>
        <div id="completed-tasks-container" 
             hx-get="article/completed-tasks?batch_name={{ batch_name }}"
             hx-trigger="load delay:500ms, taskCompleted from:body, refreshCompletedTaskCount from:body"
             hx-swap="innerHTML"
             hx-indicator="#completed-tasks-loading"
             hx-sync="this:drop">
            <div class="flex items-center justify-center p-8 bg-gray-50 rounded mb-4">
                <div class="loading-spinner"></div>
                <span class="ml-2 text-gray-600">正在載入已完成任務...</span>
            </div>
        </div>
    </div>
    
    <!-- 說明文字 -->
    <div class="mt-4 p-3 bg-blue-50 border border-blue-200 rounded text-sm text-blue-800">
        <div class="flex items-start">
            <svg class="w-4 h-4 mt-0.5 mr-2 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
            </svg>
            <div>
                <strong>提示：</strong>在Todoist中建立任務並加上「{{ batch_name }}」標籤即可在此顯示記事
            </div>
        </div>
    </div>
</section>

<!-- 包含任務創建 Modal -->
{% include "components/task_create_modal.html" %}