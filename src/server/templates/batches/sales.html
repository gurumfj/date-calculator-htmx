<section>
    <h4 class="font-bold text-black mb-2 pb-1">銷售資料</h4>
    {% if sales_data %}
        {% for sale in sales_data %}
        <div class="mb-4">
            <!-- 銷售日期標題 -->
            <div class="bg-gray-100 p-2 mb-1">
                <h5 class="font-bold">{{ sale.sale_date }}</h5>
                <div class="flex gap-4 text-sm">
                    <span>總數: {{ sale.daily_total_count|format_number }}</span>
                    <span>公雞: {{ sale.daily_male_count|format_number }}</span>
                    <span>母雞: {{ sale.daily_female_count|format_number }}</span>
                    {% if sale.daily_avg_price %}
                    <span>均價: {{ "%.1f"|format(sale.daily_avg_price) }}</span>
                    {% endif %}
                </div>
            </div>

            <!-- 日齡資訊 -->
            {% if sale.dayage_details %}
            <div class="p-2 bg-blue-50 mb-1">
                <h6 class="font-bold mb-1">日齡資訊:</h6>
                {% for dayage in sale.dayage_details %}
                <div class="text-sm">
                    {{ dayage.chicken_breed }} - {{ dayage.breed_date }} ({{ dayage.dayage }}日齡) - {{ dayage.supplier }}
                </div>
                {% endfor %}
            </div>
            {% endif %}

            <!-- 客戶銷售詳情 -->
            <table class="table w-full ml-4">
                <thead class="hidden sm:table-header-group">
                    <tr class="bg-gray-100">
                        <th class="p-2 text-left font-bold">客戶</th>
                        <th class="p-2 text-left font-bold">公雞</th>
                        <th class="p-2 text-left font-bold">母雞</th>
                        <th class="p-2 text-left font-bold">公重</th>
                        <th class="p-2 text-left font-bold">母重</th>
                        <th class="p-2 text-left font-bold">重量</th>
                        <th class="p-2 text-left font-bold">金額</th>
                        <th class="p-2 text-left font-bold">均價</th>
                    </tr>
                </thead>
                <tbody>
                    {% for detail in sale.sales_details %}
                    <tr class="hidden sm:table-row">
                        <td class="p-2">{{ detail.customer }}</td>
                        <td class="p-2">{{ (detail.male_count or 0)|format_number }}</td>
                        <td class="p-2">{{ (detail.female_count or 0)|format_number }}</td>
                        <td class="p-2">{{ "%.2f"|format(detail.male_avg_weight or 0) }}</td>
                        <td class="p-2">{{ "%.2f"|format(detail.female_avg_weight or 0) }}</td>
                        <td class="p-2">
                            {% if detail.total_weight %}{{ "%.1f"|format(detail.total_weight) }}{% else %}-{% endif %}
                        </td>
                        <td class="p-2">
                            {% if detail.total_price %}{{ (detail.total_price or 0)|format_number }}{% else %}-{% endif %}
                        </td>
                        <td class="p-2">
                            {% if detail.avg_price %}{{ "%.1f"|format(detail.avg_price) }}{% else %}-{% endif %}
                        </td>
                    </tr>
                    <!-- 手機版顯示 -->
                    <tr class="border-b border-black sm:hidden">
                        <td class="px-8 py-2 flex items-center justify-center border-b border-gray-200">
                            <span class="font-bold">{{ detail.customer }}</span>
                        </td>
                        <td class="px-8 py-2 flex items-center justify-between border-b border-gray-200">
                            <span class="font-bold">公雞</span><span>{{ (detail.male_count or 0)|format_number }}</span>
                        </td>
                        <td class="px-8 py-2 flex items-center justify-between border-b border-gray-200">
                            <span class="font-bold">母雞</span><span>{{ (detail.female_count or 0)|format_number }}</span>
                        </td>
                        <td class="px-8 py-2 flex items-center justify-between border-b border-gray-200">
                            <span class="font-bold">公重</span><span>{{ "%.2f"|format(detail.male_avg_weight or 0) }}</span>
                        </td>
                        <td class="px-8 py-2 flex items-center justify-between border-b border-gray-200">
                            <span class="font-bold">母重</span><span>{{ "%.2f"|format(detail.female_avg_weight or 0) }}</span>
                        </td>
                        <td class="px-8 py-2 flex items-center justify-between border-b border-gray-200">
                            <span class="font-bold">重量</span>
                            <span>{% if detail.total_weight %}{{ "%.1f"|format(detail.total_weight) }}{% else %}-{% endif %}</span>
                        </td>
                        <td class="px-8 py-2 flex items-center justify-between border-b border-gray-200">
                            <span class="font-bold">金額</span>
                            <span>{% if detail.total_price %}{{ (detail.total_price or 0)|format_number }}{% else %}-{% endif %}</span>
                        </td>
                        <td class="px-8 py-2 flex items-center justify-between border-b border-gray-200">
                            <span class="font-bold">均價</span>
                            <span>{% if detail.avg_price %}{{ "%.1f"|format(detail.avg_price) }}{% else %}-{% endif %}</span>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% endfor %}
    {% else %}
        <p class="p-4 text-center text-gray-600">此批次無銷售記錄</p>
    {% endif %}
</section>